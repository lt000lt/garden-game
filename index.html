<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garden Growing Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #00bcd4, #26c6da, #00897b);
            font-family: Arial, sans-serif;
            padding: 1rem;
            position: relative;
            overflow-x: auto;
        }

        .bg-particles {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.2;
            animation: pulse 2s infinite;
        }

        .particle:nth-child(1) { width: 8px; height: 8px; top: 10%; left: 20%; animation-delay: 0s; }
        .particle:nth-child(2) { width: 4px; height: 4px; top: 30%; left: 80%; animation-delay: 1s; }
        .particle:nth-child(3) { width: 12px; height: 12px; top: 60%; left: 15%; animation-delay: 2s; }
        .particle:nth-child(4) { width: 4px; height: 4px; top: 80%; left: 70%; animation-delay: 3s; }

        @keyframes pulse {
            0%, 100% { opacity: 0.15; }
            50% { opacity: 0.3; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 255, 0, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 255, 0, 0.8); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 1.5rem;
        }

        .main-game {
            flex: 1;
        }

        .game-panel {
            background: linear-gradient(135deg, #f0fdff, white);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 10;
        }

        .title {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            background: linear-gradient(45deg, #16a085, #00796b, #1565c0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 1.5rem;
            animation: pulse 2s infinite;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            font-weight: bold;
            font-size: 1.125rem;
            transition: transform 0.2s;
        }

        .stat-item:hover {
            transform: scale(1.05);
        }

        .money-stat {
            background: linear-gradient(135deg, #fef3c7, #fcd34d);
            color: #92400e;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .time-stat {
            background: linear-gradient(135deg, #bfdbfe, #93c5fd);
            color: #1e40af;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .coin-icon {
            animation: bounce 1s infinite;
        }

        .power-up-active {
            text-align: center;
            margin-bottom: 1rem;
            animation: pulse 1s infinite;
        }

        .power-up-badge {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: bold;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            transform: scale(1.1);
            animation: bounce 0.5s infinite;
        }

        .sunlight-active {
            background: linear-gradient(135deg, #fef3c7, #fed7aa);
            color: #ea580c;
            border: 1px solid #fb923c;
        }

        .frozen-active {
            background: linear-gradient(135deg, #bfdbfe, #a5f3fc);
            color: #0891b2;
            border: 1px solid #06b6d4;
        }

        .game-over {
            text-align: center;
            margin-bottom: 1.5rem;
            animation: bounce 1s infinite;
        }

        .game-over h2 {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(45deg, #16a085, #1565c0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 1rem;
        }

        .final-score {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            font-weight: 600;
            color: #374151;
        }

        .score-value {
            color: #059669;
        }

        .name-input-section {
            text-align: center;
            margin-bottom: 1.5rem;
            animation: pulse 1s infinite;
        }

        .name-input-section h3 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #7c3aed, #ec4899);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .name-input-form {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
        }

        .name-input {
            padding: 0.75rem 1rem;
            border: 2px solid #c4b5fd;
            border-radius: 0.75rem;
            background: linear-gradient(135deg, white, #faf5ff);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            font-weight: 600;
            font-size: 1rem;
        }

        .name-input:focus {
            outline: none;
            border-color: #8b5cf6;
        }

        .tools {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .tool-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .tool-btn:hover {
            transform: scale(1.05);
        }

        .tool-btn.active {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
        }

        .tool-btn.inactive {
            background: linear-gradient(135deg, #e5e7eb, #d1d5db);
            color: #374151;
        }

        .tool-btn.inactive:hover {
            background: linear-gradient(135deg, #d1d5db, #9ca3af);
        }

        .tool-water.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
        }

        .tool-harvest.active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 8px 16px rgba(245, 158, 11, 0.3);
        }

        .tool-harvest-all {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            box-shadow: 0 8px 16px rgba(139, 92, 246, 0.3);
        }

        .tool-harvest-all:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
        }

        .plant-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            justify-content: center;
            margin-bottom: 1.5rem;
            max-width: 48rem;
            margin-left: auto;
            margin-right: auto;
        }

        .plant-btn {
            padding: 0.75rem 1rem;
            border: 2px solid;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            position: relative;
            background: linear-gradient(135deg, white, #f9fafb);
        }

        .plant-btn:hover:not(.disabled) {
            transform: scale(1.05);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .plant-btn.selected {
            border-color: #10b981;
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
        }

        .plant-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .plant-name {
            font-size: 0.875rem;
            font-weight: bold;
            color: #059669;
        }

        .plant-btn.disabled .plant-name {
            color: #6b7280;
        }

        .plant-cost, .plant-value, .plant-stock {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .stock-high { color: #059669; }
        .stock-medium { color: #d97706; }
        .stock-empty { color: #dc2626; }

        .out-of-stock {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(239, 68, 68, 0.8);
            border-radius: 0.75rem;
            color: white;
            font-weight: bold;
            font-size: 0.75rem;
        }

        .garden-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.5rem;
            background: linear-gradient(135deg, #fef3c7, #fde047);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
            max-width: 32rem;
            margin: 0 auto;
            border: 1px solid #fbbf24;
        }

        .grid-cell {
            width: 3.5rem;
            height: 3.5rem;
            border: 2px solid #fbbf24;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, #fef3c7, #fde047);
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            position: relative;
        }

        .grid-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .grid-cell.ready-harvest {
            border-color: #10b981;
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
            animation: pulse 1s infinite;
        }

        .grid-cell:hover {
            border-color: #f59e0b;
        }

        .cell-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .plant-emoji {
            font-size: 1.5rem;
        }

        .water-indicator {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 0.75rem;
            animation: pulse 1s infinite;
        }

        .water-bonus {
            position: absolute;
            bottom: 0;
            left: 0;
            font-size: 0.75rem;
            color: #1d4ed8;
            font-weight: bold;
        }

        .power-up-effect {
            position: absolute;
            inset: 0;
            border-radius: 0.5rem;
            animation: pulse 0.5s infinite;
        }

        .power-up-sunlight {
            background: rgba(251, 191, 36, 0.4);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }

        .power-up-frozen {
            background: rgba(6, 182, 212, 0.4);
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
        }

        .power-up-icon {
            position: absolute;
            top: 0;
            left: 0;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .instructions {
            margin-top: 1.5rem;
            text-align: center;
            font-size: 0.875rem;
            color: #374151;
            background: linear-gradient(135deg, #eff6ff, #faf5ff);
            border-radius: 0.75rem;
            padding: 1rem;
            border: 1px solid #bfdbfe;
        }

        .instructions-title {
            font-weight: bold;
            font-size: 1.125rem;
            color: #1e40af;
            margin-bottom: 0.5rem;
        }

        .instructions p {
            margin-bottom: 0.5rem;
        }

        .instructions-emphasis {
            font-weight: 600;
        }

        .instructions-tip {
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #7c2d12;
        }

        .instructions-hint {
            font-size: 0.75rem;
            color: #059669;
            font-weight: 600;
        }

        .reset-btn {
            display: block;
            margin: 1.5rem auto 0;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .reset-btn:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn-green {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-green:hover {
            background: linear-gradient(135deg, #059669, #047857);
        }

        .btn-blue {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .btn-blue:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
        }

        .btn-purple {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .btn-purple:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
        }

        .sidebar {
            width: 20rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .power-ups-panel {
            background: linear-gradient(135deg, #f3e8ff, #fce7f3);
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
            border: 1px solid #c4b5fd;
        }

        .power-ups-title {
            font-size: 1.125rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #7c3aed, #ec4899);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .power-ups-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .power-up-btn {
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .power-up-btn:hover:not(.disabled) {
            transform: scale(1.05);
        }

        .power-up-btn.sunlight {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
        }

        .power-up-btn.sunlight:hover:not(.disabled) {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .power-up-btn.frozen {
            background: linear-gradient(135deg, #60a5fa, #06b6d4);
            color: white;
        }

        .power-up-btn.frozen:hover:not(.disabled) {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
        }

        .power-up-btn.disabled {
            background: #d1d5db;
            color: #6b7280;
            cursor: not-allowed;
        }

        .power-up-desc {
            font-size: 0.75rem;
            display: block;
        }

        .leaderboard-panel {
            background: linear-gradient(135deg, #fef3c7, #fed7aa);
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
            border: 1px solid #fbbf24;
        }

        .leaderboard-title {
            font-size: 1.125rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 0.75rem;
            background: linear-gradient(45deg, #d97706, #ea580c);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 16rem;
            overflow-y: auto;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 0.5rem;
            border: 1px solid #fde047;
        }

        .leaderboard-rank {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .rank-number {
            font-weight: bold;
            color: #d97706;
        }

        .player-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.875rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-score {
            font-weight: bold;
            color: #059669;
        }

        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                flex-direction: row;
            }
            
            .power-ups-panel,
            .leaderboard-panel {
                flex: 1;
            }
        }

        @media (max-width: 768px) {
            .stats {
                flex-direction: column;
                align-items: center;
            }
            
            .tools {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .plant-selection {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .garden-grid {
                gap: 0.25rem;
                padding: 1rem;
            }
            
            .grid-cell {
                width: 2.5rem;
                height: 2.5rem;
            }
            
            .sidebar {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="bg-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <div class="container">
        <!-- Main Game Area -->
        <div class="main-game">
            <div class="game-panel">
                <h1 class="title">🌱 Garden Growing Game 🌱</h1>
                
                <div class="stats">
                    <div class="stat-item money-stat">
                        <span class="coin-icon">🪙</span>
                        <span id="money-display">$50</span>
                    </div>
                    <div class="stat-item time-stat">
                        <span>⏰ <span id="time-display">180s left</span></span>
                    </div>
                </div>

                <div id="power-up-active" class="power-up-active" style="display: none;">
                    <div id="power-up-badge" class="power-up-badge"></div>
                </div>

                <div id="game-over" class="game-over" style="display: none;">
                    <h2>🎉 Game Over! 🎉</h2>
                    <p class="final-score">Final Score: <span id="final-score" class="score-value"></span></p>
                    <button id="add-to-leaderboard" class="btn btn-green" style="margin-right: 1rem;">🏆 Add to Leaderboard</button>
                    <button id="play-again" class="btn btn-blue">🔄 Play Again</button>
                </div>

                <div id="name-input-section" class="name-input-section" style="display: none;">
                    <h3>✨ Enter Your Name ✨</h3>
                    <div class="name-input-form">
                        <input type="text" id="player-name" class="name-input" placeholder="Enter your name" maxlength="20">
                        <button id="submit-score" class="btn btn-purple">🚀 Submit</button>
                    </div>
                </div>

                <div id="tools" class="tools">
                    <button id="tool-plant" class="tool-btn active" data-tool="plant">
                        🌱 Plant
                    </button>
                    <button id="tool-water" class="tool-btn inactive tool-water" data-tool="water">
                        💧 Water (+30%)
                    </button>
                    <button id="tool-harvest" class="tool-btn inactive tool-harvest" data-tool="harvest">
                        🥕 Harvest
                    </button>
                    <button id="harvest-all" class="tool-btn tool-harvest-all">
                        🥕 Harvest All
                    </button>
                </div>

                <div id="plant-selection" class="plant-selection"></div>

                <div class="garden-grid" id="garden-grid"></div>

                <div class="instructions">
                    <p class="instructions-title">🎯 How to play: You have 3 minutes to make as much money as possible!</p>
                    <p class="instructions-emphasis">🌱 Plant seeds (drag to plant multiple) • 💧 Water plants for +30% profit (drag to water multiple) • 🥕 Harvest mature plants</p>
                    <p class="instructions-tip">📦 Each plant has 15 stock, replenished every 30 seconds • Cherry Blossom costs 30K but gives massive returns!</p>
                    <p class="instructions-hint">💡 Tip: Hold and drag to plant/water quickly! Water is permanent until harvest!</p>
                </div>

                <button id="reset-game" class="reset-btn">🔄 Reset Game</button>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Power-ups -->
            <div id="power-ups" class="power-ups-panel">
                <h3 class="power-ups-title">⚡ Power-ups</h3>
                <div class="power-ups-list">
                    <button id="sunlight-power" class="power-up-btn sunlight">
                        ☀️ Sunlight (<span id="sunlight-uses">2</span> uses)
                        <span class="power-up-desc">+100% value</span>
                    </button>
                    <button id="frozen-power" class="power-up-btn frozen">
                        ❄️ Frozen (<span id="frozen-uses">1</span> uses)
                        <span class="power-up-desc">+200% value</span>
                    </button>
                </div>
            </div>

            <!-- Leaderboard -->
            <div class="leaderboard-panel">
                <h3 class="leaderboard-title">🏆 Leaderboard</h3>
                <div id="leaderboard-list" class="leaderboard-list"></div>
            </div>
        </div>
    </div>

    <script>
        // Game constants
        const GRID_SIZE = 8;
        const INITIAL_MONEY = 50;
        const GAME_DURATION = 180000; // 3 minutes
        const STOCK_REFRESH_INTERVAL = 30000; // 30 seconds

        // Plant types
        const PLANT_TYPES = {
            carrot: { name: 'Carrot', cost: 25, growthTime: 3000, valueRange: [30, 60], color: '#FF6B35', stages: ['🌱', '🌿', '🥕'] },
            cherry_blossom: { name: 'Cherry Blossom', cost: 30000, growthTime: 12000, valueRange: [45000, 75000], color: '#FFB6C1', stages: ['🌱', '🌿', '🌸'] },
            corn: { name: 'Corn', cost: 5000, growthTime: 8000, valueRange: [7500, 12000], color: '#FFD700', stages: ['🌱', '🌿', '🌽'] },
            sunflower: { name: 'Sunflower', cost: 400, growthTime: 7000, valueRange: [600, 1000], color: '#FFD700', stages: ['🌱', '🌿', '🌻'] },
            pepper: { name: 'Pepper', cost: 10000, growthTime: 5500, valueRange: [15000, 23000], color: '#FF4500', stages: ['🌱', '🌿', '🌶️'] },
            pumpkin: { name: 'Pumpkin', cost: 2000, growthTime: 10000, valueRange: [2500, 4500], color: '#FF8C00', stages: ['🌱', '🌿', '🎃'] }
        };

        // Game state
        let grid = [];
        let money = INITIAL_MONEY;
        let selectedPlant = 'carrot';
        let tool = 'plant';
        let gameTime = 0;
        let gameEnded = false;
        let sunlightUses = 2;
        let frozenUses = 1;
        let activePowerUp = null;
        let plantStock = {};
        let powerUpEffects = {};
        let isMouseDown = false;
        let gameInterval = null;

        // DOM elements
        const moneyDisplay = document.getElementById('money-display');
        const timeDisplay = document.getElementById('time-display');
        const powerUpActive = document.getElementById('power-up-active');
        const powerUpBadge = document.getElementById('power-up-badge');
        const gameOverDiv = document.getElementById('game-over');
        const finalScoreSpan = document.getElementById('final-score');
        const nameInputSection = document.getElementById('name-input-section');
        const playerNameInput = document.getElementById('player-name');
        const toolsDiv = document.getElementById('tools');
        const plantSelectionDiv = document.getElementById('plant-selection');
        const gardenGridDiv = document.getElementById('garden-grid');
        const leaderboardList = document.getElementById('leaderboard-list');
        const powerUpsDiv = document.getElementById('power-ups');
        const sunlightUsesSpan = document.getElementById('sunlight-uses');
        const frozenUsesSpan = document.getElementById('frozen-uses');

        // Initialize game
        function initializeGame() {
            initializeGrid();
            initializePlantStock();
            createPlantSelection();
            createGardenGrid();
            loadLeaderboard();
            updateDisplay();
            startGameLoop();
            setupEventListeners();
        }

        function initializeGrid() {
            grid = Array(GRID_SIZE).fill(null).map(() => 
                Array(GRID_SIZE).fill(null).map(() => ({
                    plant: null,
                    stage: 0,
                    plantedAt: null,
                    watered: false,
                    lastWatered: null,
                    waterBonus: false
                }))
            );
        }

        function initializePlantStock() {
            plantStock = {};
            Object.keys(PLANT_TYPES).forEach(plant => {
                plantStock[plant] = 15;
            });
        }

        function createPlantSelection() {
            plantSelectionDiv.innerHTML = '';
            Object.entries(PLANT_TYPES).forEach(([key, plant]) => {
                const button = document.createElement('button');
                button.className = 'plant-btn';
                button.dataset.plant = key;
                button.innerHTML = `
                    <div class="plant-name">${plant.name}</div>
                    <div class="plant-cost">$${plant.cost.toLocaleString()}</div>
                    <div class="plant-value">$${plant.valueRange[0].toLocaleString()}-${plant.valueRange[1].toLocaleString()}</div>
                    <div class="plant-stock">Stock: <span class="stock-count">${plantStock[key]}</span></div>
                `;
                plantSelectionDiv.appendChild(button);
            });
        }

        function createGardenGrid() {
            gardenGridDiv.innerHTML = '';
            for (let row = 0; row < GRID_SIZE; row++) {
                for (let col = 0; col < GRID_SIZE; col++) {
                    const cell = document.createElement('button');
                    cell.className = 'grid-cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.innerHTML = '<div class="cell-content"><span class="plant-emoji">🟫</span></div>';
                    gardenGridDiv.appendChild(cell);
                }
            }
        }

        function updateDisplay() {
            moneyDisplay.textContent = `$${money.toLocaleString()}`;
            timeDisplay.textContent = `${Math.floor((GAME_DURATION - gameTime) / 1000)}s left`;
            sunlightUsesSpan.textContent = sunlightUses;
            frozenUsesSpan.textContent = frozenUses;

            // Update plant selection buttons
            document.querySelectorAll('.plant-btn').forEach(btn => {
                const plantKey = btn.dataset.plant;
                const plant = PLANT_TYPES[plantKey];
                const stockCount = btn.querySelector('.stock-count');
                stockCount.textContent = plantStock[plantKey];
                
                // Update button state
                const canAfford = money >= plant.cost;
                const hasStock = plantStock[plantKey] > 0;
                const isSelected = selectedPlant === plantKey;
                
                btn.className = 'plant-btn';
                if (isSelected) btn.classList.add('selected');
                if (!canAfford || !hasStock) btn.classList.add('disabled');
                
                // Update stock color
                if (plantStock[plantKey] > 5) {
                    stockCount.className = 'stock-high';
                } else if (plantStock[plantKey] > 0) {
                    stockCount.className = 'stock-medium';
                } else {
                    stockCount.className = 'stock-empty';
                }
                
                // Add out of stock overlay
                let overlay = btn.querySelector('.out-of-stock');
                if (!hasStock) {
                    if (!overlay) {
                        overlay = document.createElement('div');
                        overlay.className = 'out-of-stock';
                        overlay.textContent = 'OUT OF STOCK';
                        btn.appendChild(overlay);
                    }
                } else if (overlay) {
                    overlay.remove();
                }
            });

            // Update power-up buttons
            const sunlightBtn = document.getElementById('sunlight-power');
            const frozenBtn = document.getElementById('frozen-power');
            
            if (sunlightUses === 0 || activePowerUp) {
                sunlightBtn.classList.add('disabled');
            } else {
                sunlightBtn.classList.remove('disabled');
            }
            
            if (frozenUses === 0 || activePowerUp) {
                frozenBtn.classList.add('disabled');
            } else {
                frozenBtn.classList.remove('disabled');
            }

            // Update active power-up display
            if (activePowerUp) {
                powerUpActive.style.display = 'block';
                if (activePowerUp === 'sunlight') {
                    powerUpBadge.textContent = '✨ Sunlight Active! (+100% value) ✨';
                    powerUpBadge.className = 'power-up-badge sunlight-active';
                } else if (activePowerUp === 'frozen') {
                    powerUpBadge.textContent = '✨ Frozen Active! (+200% value) ✨';
                    powerUpBadge.className = 'power-up-badge frozen-active';
                }
            } else {
                powerUpActive.style.display = 'none';
            }

            // Show/hide game elements based on game state
            if (gameEnded) {
                toolsDiv.style.display = 'none';
                plantSelectionDiv.style.display = 'none';
                powerUpsDiv.style.display = 'none';
                gameOverDiv.style.display = 'block';
                finalScoreSpan.textContent = `$${money.toLocaleString()}`;
            } else {
                if (tool === 'plant') {
                    plantSelectionDiv.style.display = 'grid';
                } else {
                    plantSelectionDiv.style.display = 'none';
                }
                toolsDiv.style.display = 'flex';
                powerUpsDiv.style.display = 'block';
                gameOverDiv.style.display = 'none';
            }

            updateGardenDisplay();
        }

        function updateGardenDisplay() {
            const cells = document.querySelectorAll('.grid-cell');
            cells.forEach(cell => {
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                const cellData = grid[row][col];
                const content = cell.querySelector('.cell-content');
                
                if (!cellData.plant) {
                    content.innerHTML = '<span class="plant-emoji">🟫</span>';
                    cell.classList.remove('ready-harvest');
                } else {
                    const plant = PLANT_TYPES[cellData.plant];
                    const emoji = plant.stages[cellData.stage];
                    const cellKey = `${row}-${col}`;
                    const powerUpEffect = powerUpEffects[cellKey];
                    
                    let html = `<span class="plant-emoji">${emoji}</span>`;
                    
                    if (cellData.waterBonus) {
                        html += '<div class="water-indicator">💧</div>';
                        html += '<div class="water-bonus">+30%</div>';
                    }
                    
                    if (powerUpEffect) {
                        const effectClass = powerUpEffect === 'sunlight' ? 'power-up-sunlight' : 'power-up-frozen';
                        const icon = powerUpEffect === 'sunlight' ? '☀️' : '❄️';
                        html += `<div class="power-up-effect ${effectClass}"></div>`;
                        html += `<div class="power-up-icon">${icon}</div>`;
                    }
                    
                    content.innerHTML = html;
                    
                    if (cellData.stage === 2) {
                        cell.classList.add('ready-harvest');
                    } else {
                        cell.classList.remove('ready-harvest');
                    }
                }
            });
        }

        function startGameLoop() {
            if (gameInterval) clearInterval(gameInterval);
            
            gameInterval = setInterval(() => {
                if (gameEnded) return;
                
                gameTime += 100;
                
                // Check stock refresh
                if (gameTime % STOCK_REFRESH_INTERVAL === 0 && gameTime > 0) {
                    Object.keys(PLANT_TYPES).forEach(plant => {
                        plantStock[plant] = 15;
                    });
                }
                
                // Check game end
                if (gameTime >= GAME_DURATION) {
                    endGame();
                    return;
                }
                
                // Update plant growth
                updatePlantGrowth();
                updateDisplay();
            }, 100);
        }

        function updatePlantGrowth() {
            grid.forEach(row => {
                row.forEach(cell => {
                    if (!cell.plant) return;
                    
                    const plant = PLANT_TYPES[cell.plant];
                    const timeSincePlanted = Date.now() - cell.plantedAt;
                    const growthProgress = timeSincePlanted / plant.growthTime;
                    
                    let newStage = cell.stage;
                    
                    if (cell.waterBonus) {
                        if (growthProgress >= 0.33 && newStage < 1) newStage = 1;
                        if (growthProgress >= 0.66 && newStage < 2) newStage = 2;
                    } else {
                        if (growthProgress >= 0.5 && newStage < 1) newStage = 1;
                        if (growthProgress >= 1 && newStage < 2) newStage = 2;
                    }
                    
                    cell.stage = newStage;
                });
            });
        }

        function endGame() {
            gameEnded = true;
            if (gameInterval) clearInterval(gameInterval);
            
            // Clear all plants without giving money
            initializeGrid();
            updateDisplay();
        }

        function plantSeed(row, col) {
            const cell = grid[row][col];
            const plant = PLANT_TYPES[selectedPlant];
            
            if (!cell.plant && money >= plant.cost && plantStock[selectedPlant] > 0) {
                cell.plant = selectedPlant;
                cell.stage = 0;
                cell.plantedAt = Date.now();
                cell.watered = false;
                cell.lastWatered = null;
                cell.waterBonus = false;
                
                money -= plant.cost;
                plantStock[selectedPlant]--;
            }
        }

        function waterPlant(row, col) {
            const cell = grid[row][col];
            if (cell.plant && !cell.waterBonus) {
                cell.watered = true;
                cell.lastWatered = Date.now();
                cell.waterBonus = true;
            }
        }

        function harvestPlant(row, col) {
            const cell = grid[row][col];
            if (!cell.plant || cell.stage !== 2) return;
            
            const plant = PLANT_TYPES[cell.plant];
            let harvestValue = Math.floor(Math.random() * (plant.valueRange[1] - plant.valueRange[0] + 1)) + plant.valueRange[0];
            
            // Apply water bonus
            if (cell.waterBonus) {
                harvestValue *= 1.3;
            }
            
            // Apply power-up effects
            if (activePowerUp) {
                const cellKey = `${row}-${col}`;
                
                // Show visual effect
                powerUpEffects[cellKey] = activePowerUp;
                setTimeout(() => {
                    delete powerUpEffects[cellKey];
                    updateGardenDisplay();
                }, 2000);
                
                if (activePowerUp === 'sunlight') {
                    harvestValue *= 2; // 100% boost
                } else if (activePowerUp === 'frozen') {
                    harvestValue *= 3; // 200% boost
                }
            }
            
            harvestValue = Math.floor(harvestValue);
            money += harvestValue;
            
            // Clear cell
            cell.plant = null;
            cell.stage = 0;
            cell.plantedAt = null;
            cell.watered = false;
            cell.lastWatered = null;
            cell.waterBonus = false;
        }

        function harvestAll() {
            let totalHarvested = 0;
            grid.forEach((row, rowIndex) => {
                row.forEach((cell, colIndex) => {
                    if (cell.plant && cell.stage === 2) {
                        harvestPlant(rowIndex, colIndex);
                        totalHarvested++;
                    }
                });
            });
            return totalHarvested;
        }

        function activatePowerUp(type) {
            if (activePowerUp) return;
            
            if (type === 'sunlight' && sunlightUses > 0) {
                sunlightUses--;
                activePowerUp = 'sunlight';
                setTimeout(() => {
                    activePowerUp = null;
                    updateDisplay();
                }, 8000);
            } else if (type === 'frozen' && frozenUses > 0) {
                frozenUses--;
                activePowerUp = 'frozen';
                setTimeout(() => {
                    activePowerUp = null;
                    updateDisplay();
                }, 8000);
            }
        }

        function resetGame() {
            if (gameInterval) clearInterval(gameInterval);
            
            gameTime = 0;
            money = INITIAL_MONEY;
            gameEnded = false;
            selectedPlant = 'carrot';
            tool = 'plant';
            sunlightUses = 2;
            frozenUses = 1;
            activePowerUp = null;
            powerUpEffects = {};
            isMouseDown = false;
            
            // Reset UI
            nameInputSection.style.display = 'none';
            playerNameInput.value = '';
            
            // Update tool selection
            document.querySelectorAll('.tool-btn').forEach(btn => {
                if (btn.dataset.tool === 'plant') {
                    btn.classList.add('active');
                    btn.classList.remove('inactive');
                } else if (btn.dataset.tool) {
                    btn.classList.remove('active');
                    btn.classList.add('inactive');
                }
            });
            
            initializeGrid();
            initializePlantStock();
            updateDisplay();
            startGameLoop();
        }

        // Leaderboard functions
        function loadLeaderboard() {
            try {
                const saved = localStorage.getItem('gardenGameLeaderboard');
                if (saved) {
                    const leaderboard = JSON.parse(saved);
                    displayLeaderboard(leaderboard);
                }
            } catch (e) {
                console.log('Note: Leaderboard persistence not available in this environment');
            }
        }

        function saveLeaderboard(leaderboard) {
            try {
                localStorage.setItem('gardenGameLeaderboard', JSON.stringify(leaderboard));
            } catch (e) {
                console.log('Note: Leaderboard persistence not available in this environment');
            }
        }

        function displayLeaderboard(leaderboard) {
            leaderboardList.innerHTML = '';
            leaderboard.slice(0, 5).forEach((entry, index) => {
                const div = document.createElement('div');
                div.className = 'leaderboard-entry';
                div.innerHTML = `
                    <div class="leaderboard-rank">
                        <span class="rank-number">#${index + 1}</span>
                        <span class="player-name">${entry.name}</span>
                    </div>
                    <span class="player-score">$${entry.score.toLocaleString()}</span>
                `;
                leaderboardList.appendChild(div);
            });
        }

        function addToLeaderboard(name, score) {
            try {
                let leaderboard = [];
                const saved = localStorage.getItem('gardenGameLeaderboard');
                if (saved) {
                    leaderboard = JSON.parse(saved);
                }
                
                leaderboard.push({
                    name: name.trim(),
                    score: score,
                    date: new Date().toLocaleDateString()
                });
                
                leaderboard.sort((a, b) => b.score - a.score);
                leaderboard = leaderboard.slice(0, 10);
                
                saveLeaderboard(leaderboard);
                displayLeaderboard(leaderboard);
            } catch (e) {
                console.log('Note: Leaderboard persistence not available in this environment');
            }
        }

        function setupEventListeners() {
            // Tool selection
            document.querySelectorAll('.tool-btn[data-tool]').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (gameEnded) return;
                    
                    tool = btn.dataset.tool;
                    document.querySelectorAll('.tool-btn[data-tool]').forEach(b => {
                        b.classList.remove('active');
                        b.classList.add('inactive');
                    });
                    btn.classList.add('active');
                    btn.classList.remove('inactive');
                    updateDisplay();
                });
            });

            // Harvest all
            document.getElementById('harvest-all').addEventListener('click', () => {
                if (!gameEnded) {
                    harvestAll();
                    updateDisplay();
                }
            });

            // Plant selection
            plantSelectionDiv.addEventListener('click', (e) => {
                const btn = e.target.closest('.plant-btn');
                if (btn && !btn.classList.contains('disabled')) {
                    selectedPlant = btn.dataset.plant;
                    updateDisplay();
                }
            });

            // Garden grid interactions
            gardenGridDiv.addEventListener('mousedown', (e) => {
                e.preventDefault();
                const cell = e.target.closest('.grid-cell');
                if (cell && !gameEnded) {
                    isMouseDown = true;
                    handleCellInteraction(cell);
                }
            });

            gardenGridDiv.addEventListener('mousemove', (e) => {
                if (isMouseDown && !gameEnded) {
                    const cell = e.target.closest('.grid-cell');
                    if (cell) {
                        handleCellInteraction(cell);
                    }
                }
            });

            document.addEventListener('mouseup', () => {
                isMouseDown = false;
            });

            // Power-ups
            document.getElementById('sunlight-power').addEventListener('click', () => {
                if (!gameEnded) {
                    activatePowerUp('sunlight');
                    updateDisplay();
                }
            });

            document.getElementById('frozen-power').addEventListener('click', () => {
                if (!gameEnded) {
                    activatePowerUp('frozen');
                    updateDisplay();
                }
            });

            // Game controls
            document.getElementById('reset-game').addEventListener('click', resetGame);
            document.getElementById('play-again').addEventListener('click', resetGame);
            
            document.getElementById('add-to-leaderboard').addEventListener('click', () => {
                nameInputSection.style.display = 'block';
                gameOverDiv.style.display = 'none';
            });

            document.getElementById('submit-score').addEventListener('click', () => {
                const name = playerNameInput.value.trim();
                if (name) {
                    addToLeaderboard(name, money);
                    nameInputSection.style.display = 'none';
                    gameOverDiv.style.display = 'block';
                    playerNameInput.value = '';
                }
            });

            // Enter key for name submission
            playerNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('submit-score').click();
                }
            });
        }

        function handleCellInteraction(cell) {
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            const cellData = grid[row][col];
            
            if (tool === 'plant') {
                plantSeed(row, col);
            } else if (tool === 'water') {
                waterPlant(row, col);
            } else if (tool === 'harvest' && cellData.plant && cellData.stage === 2) {
                harvestPlant(row, col);
            }
            
            updateDisplay();
        }

        // Start the game
        initializeGame();
    </script>
</body>
</html>
